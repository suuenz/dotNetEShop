trigger:
- main  # ÛŒØ§ Ù†Ø§Ù… Ù‡Ø± Ø¨Ø±Ù†Ú†ÛŒ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§ÛŒ CI Ø±ÙˆÛŒ Ø§ÙˆÙ† ÙØ¹Ø§Ù„ Ø¨Ø§Ø´Ù‡

variables:
  dockerRegistryServiceConnection: 'eshopweb2025'  # ğŸ” Ø§Ø³Ù… Ø³Ø±ÙˆÛŒØ³â€ŒÚ©Ø§Ù†Ú©Ø´Ù†
  containerRegistry: 'eshopweb2025.azurecr.io'     # ğŸ” Ø¢Ø¯Ø±Ø³ Ú©Ø§Ù…Ù„ ACR
  tag: '$(Build.BuildId)'                          # ğŸ” Ø§Ø² ID Ø¨ÛŒÙ„Ø¯ Ø¨Ø±Ø§ÛŒ ØªÚ¯ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…

pool:
  vmImage: 'ubuntu-latest'

steps:

# Ù†ØµØ¨ Docker Ù†Ø³Ø®Ù‡ Ù…Ù†Ø§Ø³Ø¨
- task: DockerInstaller@0
  inputs:
    dockerVersion: 'latest'

# Ù„Ø§Ú¯ÛŒÙ† Ø¨Ù‡ ACR
- task: Docker@2
  displayName: Login to ACR
  inputs:
    command: login
    containerRegistry: $(dockerRegistryServiceConnection)

# Ø³Ø§Ø®Øª Ø§ÛŒÙ…ÛŒØ¬â€ŒÙ‡Ø§ Ø¨Ø§ docker-compose
- task: DockerCompose@0
  displayName: Build images with Docker Compose
  inputs:
    containerregistrytype: 'Azure Container Registry'
    azureSubscription: $(dockerRegistryServiceConnection)
    azureContainerRegistry: $(containerRegistry)
    dockerComposeFile: 'docker-compose.yml'
    action: 'Build services'
    includeSourceTags: true
    includeLatestTag: true
    buildImages: true

# Push Ø§ÛŒÙ…ÛŒØ¬â€ŒÙ‡Ø§ Ø¨Ù‡ ACR
- task: DockerCompose@0
  displayName: Push images with Docker Compose
  inputs:
    containerregistrytype: 'Azure Container Registry'
    azureSubscription: $(dockerRegistryServiceConnection)
    azureContainerRegistry: $(containerRegistry)
    dockerComposeFile: 'docker-compose.yml'
    action: 'Push services'
    includeSourceTags: true
    includeLatestTag: true